<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="assets/blokdbit_logo_icon.png" type="image/png">
  <title>BLOKDBIT Web Flasher</title>

  <!-- ESP Web Tools -->
  <script src="https://unpkg.com/esp-web-tools@9.1.0/dist/web/install-button.js"></script>

  <!-- ESP Web Flasher: UMD version -->
  <script src="https://unpkg.com/esp-web-flasher@9.1.0/dist/web/index.umd.js"></script>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      if (window.espWebFlasher) {
        window.ESPLoader = window.espWebFlasher.ESPLoader;
        window.WebSerialTransport = window.espWebFlasher.WebSerialTransport;
        console.log("✅ ESP Web Flasher loaded and globals assigned");
      } else {
        console.error("❌ espWebFlasher UMD not loaded correctly.");
      }

      const modelDropdown = document.getElementById("deviceModel");
      if (modelDropdown) {
        updateFirmwareOptions();
      } else {
        console.error("❌ deviceModel element not found in DOM.");
      }
    });

    function updateFirmwareOptions() {
      const modelDropdown = document.getElementById("deviceModel");
      if (!modelDropdown) {
        console.error("❌ deviceModel element not found when updating firmware options.");
        return;
      }

      const firmwareDropdown = document.getElementById("firmwareVersion");
      firmwareDropdown.innerHTML = "";

      const firmwareOptions = {
        Matrix: [
          { name: "BlokdBit Matrix v1.1", url: "https://bitcoinmanor.github.io/BlokdBit-Matrix/BlokdBit_Matrix_FINAL_SKETCH4Flasher.ino.nodemcu-32s.bin" }
        ],
        Spark: [
          { name: "BlokdBit Spark Beta", url: "https://example.com/spark-firmware.bin" }
        ],
        Pulse: [],
        Edge: [],
        Infinity: []
      };

      const selectedModel = modelDropdown.value;
      if (firmwareOptions[selectedModel]) {
        firmwareOptions[selectedModel].forEach(opt => {
          const option = document.createElement("option");
          option.value = opt.url;
          option.text = opt.name;
          firmwareDropdown.appendChild(option);
        });
      } else {
        console.error(`❌ No firmware options found for model: ${selectedModel}`);
      }
    }
  </script>
</head>
<body>
  <!-- Add the missing deviceModel element -->
  <select id="deviceModel">
    <option value="Matrix">Matrix</option>
    <option value="Spark">Spark</option>
    <option value="Pulse">Pulse</option>
    <option value="Edge">Edge</option>
    <option value="Infinity">Infinity</option>
  </select>

  <!-- Add a placeholder for firmwareVersion -->
  <select id="firmwareVersion"></select>

  <div id="log"></div>
</body>
</html>
